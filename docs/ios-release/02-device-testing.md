# 実機テスト

## 概要

実際のiPhoneまたはiPadでアプリを動作させ、機能を確認します。

**所要時間**: 20-30分

## 前提条件

- [ ] Xcodeビルドテストが完了している
- [ ] iPhoneまたはiPadが手元にある
- [ ] デバイスがMacに接続可能（USBケーブル）

## 手順

### 1. デバイスの準備

#### 1.1 デバイスをMacに接続

1. iPhoneまたはiPadをUSBケーブルでMacに接続
2. デバイスで「このコンピュータを信頼しますか？」→ **信頼**
3. パスコードを入力（求められた場合）

#### 1.2 Xcodeでデバイスを認識

1. Xcodeを開く（すでに開いている場合はそのまま）
2. 上部ツールバーのデバイス選択で、接続したデバイス名が表示されることを確認
   - 例: "Gaku's iPhone"
   - デバイス名が表示されない場合は、USB接続を確認

### 2. アプリのインストール

#### 2.1 ビルドターゲットの選択

1. Xcodeの上部ツールバーで、接続したデバイスを選択
2. スキームが `App` になっていることを確認

#### 2.2 開発者モードの有効化（iOS 16以降）

初回のみ必要な場合があります:

1. デバイスで `設定` → `プライバシーとセキュリティ` → `デベロッパモード`
2. デベロッパモードを **オン**
3. デバイスを再起動（求められた場合）

#### 2.3 アプリの実行

**方法1: Xcodeから実行**
1. `Product` → `Run` (⌘R)
2. ビルドとインストールが開始される
3. 初回は時間がかかる場合あり（1-3分）

**方法2: ショートカット**
- `⌘R` (Command + R)

**成功した場合**:
- デバイスでアプリが自動的に起動
- Xcodeのコンソールにログが表示される

### 3. 初回起動時の許可

アプリ起動時に表示される可能性のある許可ダイアログ:

1. **"Spark Vault"はデベロッパによって開発されています**
   - デバイスで: `設定` → `一般` → `VPNとデバイス管理`
   - 開発用証明書を信頼する

2. **通知の許可**（将来的に必要な場合）
   - テスト時は許可しなくてもOK

3. **写真ライブラリへのアクセス**
   - 画像添付機能をテストする場合は許可

4. **カメラへのアクセス**
   - カメラ機能をテストする場合は許可

### 4. 機能テスト

以下の機能を順番にテストします。

#### 4.1 認証機能

**テスト項目**:
- [ ] アプリが起動する
- [ ] ログイン画面が表示される
- [ ] メールアドレスとパスワードの入力欄が表示される
- [ ] 新規登録リンクが表示される

**操作手順**:
1. 新規アカウント作成 または 既存アカウントでログイン
2. エラーメッセージが適切に表示されるか確認

#### 4.2 アイデア一覧画面

**テスト項目**:
- [ ] 一覧画面が表示される
- [ ] 既存のアイデアが表示される（ある場合）
- [ ] 「+」ボタンが表示される
- [ ] スムーズにスクロールできる

#### 4.3 アイデア作成機能

**テスト項目**:
- [ ] 「+」ボタンをタップして新規作成画面が開く
- [ ] タイトル入力欄が機能する
- [ ] 内容入力欄が機能する
- [ ] カテゴリ選択ができる
- [ ] タグ入力ができる
- [ ] 保存ボタンが機能する

**操作手順**:
1. 新規アイデアを作成
2. すべての入力欄に値を入力
3. 保存ボタンをタップ
4. 一覧画面に戻り、新しいアイデアが表示されることを確認

#### 4.4 アイデア編集・削除機能

**テスト項目**:
- [ ] アイデアをタップして詳細画面が開く
- [ ] 編集ボタンが表示される
- [ ] 内容を編集できる
- [ ] 変更が保存される
- [ ] 削除機能が動作する

#### 4.5 Capacitorネイティブ機能

**テスト項目**:
- [ ] ステータスバーの色が紫色（#8b5cf6）
- [ ] スプラッシュスクリーンが表示される（起動時）
- [ ] キーボードが適切に表示される
- [ ] キーボード上部のツールバーが表示される
- [ ] 触覚フィードバック（振動）が動作する（ボタンタップ時など）

### 5. パフォーマンステスト

**テスト項目**:
- [ ] アプリの起動が3秒以内
- [ ] 画面遷移がスムーズ（1秒以内）
- [ ] スクロールが滑らか
- [ ] アプリがクラッシュしない

**ストレステスト**:
1. 大量のアイデアを作成（10件以上）
2. 長いテキストを入力
3. 複数の画面を行き来する
4. バックグラウンド→フォアグラウンドの切り替え

### 6. デバイス互換性テスト

可能であれば、複数のデバイスでテスト:

**iPhone**:
- [ ] iPhone SE（小さい画面）
- [ ] iPhone 14/15（標準画面）
- [ ] iPhone 14/15 Pro Max（大きい画面）

**iPad**:
- [ ] iPad（標準サイズ）
- [ ] iPad Pro（大画面）

**画面の向き**:
- [ ] ポートレート（縦向き）で正常に表示
- [ ] ランドスケープ（横向き）で正常に表示

### 7. ログの確認

Xcodeのコンソールで以下を確認:

**正常なログの例**:
```
Capacitor plugins not available (running on web)
Supabase client initialized
User logged in: user@example.com
```

**エラーログの例** (対処が必要):
```
Error: Network request failed
Error: Unable to connect to database
Crash: EXC_BAD_ACCESS
```

### 8. バグ記録

問題が見つかった場合は記録:

**記録項目**:
- 発生した機能
- 再現手順
- 期待される動作
- 実際の動作
- デバイス情報（機種、iOS バージョン）
- スクリーンショットまたは動画

**記録場所**:
- GitHub Issues
- または別途バグ管理シート

## チェックリスト

実機テストが完了したら、以下を確認:

- [ ] アプリがインストールできた
- [ ] すべての主要機能が動作した
- [ ] クラッシュが発生しなかった
- [ ] パフォーマンスが良好
- [ ] UIが適切に表示された
- [ ] ネイティブ機能（ステータスバー等）が動作した
- [ ] バグがある場合は記録した

## よくある問題と対処法

### 問題1: "Could not launch"

**原因**: アプリの署名が信頼されていない

**対処法**:
1. デバイスで `設定` → `一般` → `VPNとデバイス管理`
2. 開発者アプリの証明書を信頼

### 問題2: アプリがクラッシュする

**原因**: ビルド設定またはコードの問題

**対処法**:
1. Xcodeのコンソールでクラッシュログを確認
2. エラーメッセージを記録
3. 該当するコードを修正
4. 再ビルド・再テスト

### 問題3: Supabaseに接続できない

**原因**: 環境変数が設定されていない、またはネットワークエラー

**対処法**:
1. `.env` ファイルの内容を確認
2. Supabase URL と API Key が正しいか確認
3. デバイスがインターネットに接続されているか確認

### 問題4: 画面が真っ白

**原因**: Webアプリのビルドが正しく読み込まれていない

**対処法**:
```bash
npm run build
npm run cap:sync
```
その後、Xcodeで再度 Run

## 次のステップ

実機テストが完了したら、App Store申請の準備に進みます。

→ [03-privacy-policy-hosting.md](./03-privacy-policy-hosting.md)

## 参考資料

- [Testing Apps on Devices](https://developer.apple.com/documentation/xcode/running-your-app-in-simulator-or-on-a-device)
- [Debugging with Xcode](https://developer.apple.com/documentation/xcode/debugging)
